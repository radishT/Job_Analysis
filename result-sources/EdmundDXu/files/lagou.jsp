<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%
	String path = request.getContextPath();
	String basePath = request.getScheme() + "://"
			+ request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
%>
<!DOCTYPE>
<html>
<head>
<base href="<%=basePath%>">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Echarts Demo</title>
<script src="js/echarts.js" ></script>
<script src="js/echarts-wordcloud.js" ></script>
<script type="text/javascript">
	function initData() {
		// 调用后台服务器操作
		// 建立核心对象
		xmlHttp = new XMLHttpRequest();
		// 设置后台进行数据库操作的Servlet地址。此时readyState=1
		xmlHttp.open("get","LoadDataServlet");
		// 设置读取到数据后继续处理的js回调函数
		xmlHttp.onreadystatechange = initDataCallback;
		// 发送数据。此时readyState=2
		xmlHttp.send();
	}
	
	function initDataCallback() {
		// 判断数据是否完全返回了
		if (xmlHttp.readyState == 4) {
			// 判断是否正确返回
			if (xmlHttp.status == 200) {
				// 接收结果
				var result = eval("("+xmlHttp.responseText+")");
				var province=[];
				for (var i = 0;i < result.length;i++) {
					province.push({
		                name: result[i].province,
		                value: result[i].count
		            })
				}
				
				// 开始写到图表中。
				// 找到要绘制图表的div
				var myChart = echarts.init(document.getElementById('main'));
				
				var dataMap = {};
				function dataFormatter(obj) {
				    var pList = ['北京','天津','河北','山西','内蒙古','辽宁','吉林','黑龙江','上海','江苏','浙江','安徽','福建','江西','山东','河南','湖北','湖南','广东','广西','海南','重庆','四川','贵州','云南','西藏','陕西','甘肃','青海','宁夏','新疆'];
				    var langList = ['java','python','c#','web','linux']
				    var temp;
				    for (var lang = 1; lang <= 5; lang++) {
				        var max = 0;
				        var sum = 0;
				        temp = obj[lang];
				        for (var i = 0, l = temp.length; i < l; i++) {
				            max = Math.max(max, temp[i]);
				            sum += temp[i];
				            obj[lang][i] = {
				                name : pList[i],
				                value : temp[i]
				            }
				        }
				        obj[langList[lang-1] + 'max'] = Math.floor(max / 100) * 100;
				        obj[langList[lang-1] + 'sum'] = sum;
				    }
				    return obj;
				}

				dataMap.dataGDP = dataFormatter(province);

				dataMap.dataPI = dataFormatter({
				    //max : 4000,
				    5:[88.8,103.35,1461.81,276.77,634.94,939.43,672.76,750.14,93.81,1545.05,925.1,1011.03,865.98,786.14,2138.9,1916.74,1140.41,1272.2,1532.17,1032.47,323.48,386.38,1595.48,382.06,724.4,50.9,484.81,334,67.55,79.54,527.8],
				    4:[88.68,112.38,1400,262.42,589.56,882.41,625.61,684.6,90.26,1461.51,892.83,966.5,827.36,727.37,1963.51,1892.01,1082.13,1100.65,1428.27,912.5,300.75,463.4,1481.14,368.94,661.69,48.04,435.77,308.06,65.34,72.07,509.99],
				    3:[87.36,105.28,1370.43,276.3,522.8,798.43,568.69,605.79,83.45,1367.58,814.1,950.5,786.84,664.5,1778.45,1649.29,1020.09,1022.45,1248.59,817.88,278.76,428.05,1379.93,334.5,607.75,44.3,387.88,286.78,60.7,65.33,461.26],
				    2:[84.11,89.91,1064.05,215.19,420.1,615.8,488.23,504.8,81.02,1162.45,717.85,749.4,692.94,560,1480.67,1198.7,798.35,886.47,1072.91,658.78,244.29,339.06,1128.61,298.69,494.6,40.7,302.66,237.91,48.47,55.63,412.9],
				    1:[82.44,84.21,956.84,197.8,374.69,590.2,446.17,474.2,79.68,1110.44,685.2,783.66,664.78,535.98,1390,1288.36,707,847.25,1015.08,601.99,222.89,317.87,1047.95,281.1,463.44,39.75,282.21,215.51,47.31,52.95,305]
				});

				dataMap.dataSI = dataFormatter({
				    //max : 26600,
				    5:[2191.43,2457.08,6110.43,2755.66,2374.96,4566.83,1915.29,3365.31,4969.95,12282.89,8511.51,2711.18,3695.04,2419.74,12574.03,6724.61,3365.08,3187.05,13469.77,1878.56,308.62,1871.65,3775.14,967.54,1705.83,80.1,2452.44,1043.19,331.91,351.58,1459.3],
				    4:[2026.51,2135.07,5271.57,2357.04,1773.21,3869.4,1580.83,2971.68,4381.2,10524.96,7164.75,2245.9,3175.92,1917.47,10478.62,5514.14,2852.12,2612.57,11356.6,1510.68,240.83,1564,3067.23,821.16,1426.42,63.52,1951.36,838.56,264.61,281.05,1164.79],
				    3:[1853.58,1685.93,4301.73,1919.4,1248.27,3061.62,1329.68,2487.04,3892.12,8437.99,6250.38,1844.9,2770.49,1566.4,8478.69,4182.1,2320.6,2190.54,9280.73,1253.7,205.6,1376.91,2489.4,681.5,1281.63,52.74,1553.1,713.3,211.7,244.05,914.47],
				    2:[1487.15,1337.31,3417.56,1463.38,967.49,2898.89,1098.37,2084.7,3209.02,6787.11,5096.38,1535.29,2340.82,1204.33,6485.05,3310.14,1956.02,1777.74,7592.78,984.08,175.82,1135.31,2014.8,569.37,1047.66,47.64,1221.17,572.02,171.92,194.27,719.54],
				    1:[1249.99,1069.08,2911.69,1134.31,754.78,2609.85,943.49,1843.6,2622.45,5604.49,4090.48,1337.04,2036.97,941.77,5184.98,2768.75,1709.89,1523.5,6143.4,846.89,148.88,958.87,1733.38,481.96,934.88,32.72,1007.56,501.69,144.51,153.06,603.15]
				});

				dataMap.dataTI = dataFormatter({
				    //max : 25000,
				    5:[5837.55,1902.31,3895.36,1846.18,1934.35,3798.26,1687.07,2096.35,5508.48,7914.11,6281.86,2390.29,3022.83,1614.65,7187.26,3721.44,3111.98,3229.42,11585.82,1835.12,433.57,1649.2,3319.62,989.38,1557.91,159.76,1806.36,900.16,249.04,294.78,1058.16],
				    4:[4854.33,1658.19,3340.54,1611.07,1542.26,3295.45,1413.83,1857.42,4776.2,6612.22,5360.1,2137.77,2551.41,1411.92,5924.74,3181.27,2655.94,2882.88,9772.5,1560.92,377.17,1440.32,2836.73,815.32,1374.62,137.24,1546.59,787.36,213.37,259.49,929.41],
				    3:[4092.27,1319.76,2805.47,1375.67,1270,2811.95,1223.64,1657.77,4097.26,5198.03,4584.22,1963.9,2206.02,1225.8,4764.7,2722.4,2292.55,2428.95,8335.3,1361.92,335.3,1229.62,2510.3,661.8,1192.53,123.3,1234.6,688.41,193.7,227.73,833.36],
				    2:[3435.95,1150.81,2439.68,1176.65,1000.79,2487.85,1075.48,1467.9,3404.19,4493.31,3890.79,1638.42,1949.91,1043.08,4112.43,2358.86,2003.08,1995.78,7178.94,1178.25,293.85,1081.35,2189.68,558.28,1013.76,96.76,1063.89,589.91,169.81,195.46,753.91],
				    1:[2982.57,997.47,2149.75,992.69,811.47,2258.17,958.88,1319.4,3038.9,3891.92,3227.99,1399.02,1765.8,972.73,3700.52,1978.37,1795.93,1780.79,6343.94,1074.85,270.96,956.12,1943.68,480.37,914.5,89.56,963.62,514.83,148.83,171.14,704.5]
				});

				dataMap.dataEstate = dataFormatter({
				    //max : 3600,
				    5:[658.3,156.64,397.14,117.01,136.5,318.54,131.01,194.7,773.61,1017.91,794.41,281.98,435.22,184.67,786.51,348.7,294.73,254.81,1722.07,192.2,44.45,158.2,336.2,80.24,165.92,11.92,125.2,73.21,15.17,25.53,68.9],
				    4:[493.73,122.67,330.87,106,98.75,256.77,112.29,163.34,715.97,799.73,688.86,231.66,331.8,171.88,664.9,298.19,217.17,215.63,1430.37,165.05,38.2,143.88,286.23,76.38,148.69,10.02,108.62,63.78,14.1,22.97,55.79],
				    3:[436.11,106.14,231.08,95.1,73.81,203.1,97.93,137.74,666.3,534.17,587.83,188.28,248.44,167.2,473.27,236.44,204.8,191.5,1103.75,122.52,30.64,129.12,264.3,68.3,116.54,5.8,95.9,56.84,13,20.78,53.55],
				    2:[341.88,92.31,185.19,78.73,61.05,188.49,91.99,127.2,487.82,447.47,473.16,162.63,215.84,138.02,418.21,217.58,176.8,186.49,955.66,100.93,25.14,113.69,231.72,59.86,103.79,4.35,83.9,48.09,11.41,16.85,47.84],
				    1:[298.02,73.04,140.89,65.83,51.48,130.94,76.11,118.7,384.86,371.09,360.63,139.18,188.09,125.27,371.13,199.31,145.17,165.29,808.16,82.83,21.45,90.48,210.82,53.49,95.68,3.42,77.68,41.52,9.74,13.46,43.04]
				});

				dataMap.dataFinancial = dataFormatter({
				    //max : 3200,
				    5:[982.37,186.87,284.04,169.63,108.21,303.41,100.75,74.17,825.2,653.25,906.37,166.01,243.9,79.75,524.94,219.72,174.99,204.72,899.91,129.14,16.37,213.7,299.5,89.43,143.62,6.44,152.25,50.51,23.69,36.99,99.25],
				    4:[840.2,147.4,213.47,135.07,72.52,232.85,83.63,35.03,675.12,492.4,686.32,127.05,186.12,69.55,448.36,181.74,127.32,162.37,661.81,91.93,13.16,185.18,262.26,73.67,130.5,7.57,127.58,44.73,20.36,32.25,80.34],
				    3:[713.79,136.97,209.1,110.29,55.89,188.04,77.17,32.2,612.45,440.5,523.49,94.1,171,65.1,343.37,170.82,118.85,118.64,602.68,74,11.56,162.38,236.5,60.3,118.4,5.4,90.1,42.99,19,27.92,70.3],
				    2:[635.56,112.79,199.87,118.48,55.89,145.38,73.15,32.2,517.97,392.11,451.54,87.45,150.09,64.31,329.71,165.11,107.31,99.35,534.28,61.59,10.68,147.04,206.24,48.01,105.48,4.74,77.87,42.31,17.98,24.8,64.92],
				    1:[561.91,76.86,179.6,124.1,48.39,137.18,75.45,31.6,485.25,368.86,347.53,81.85,138.28,76.51,310.07,158.77,96.95,92.43,454.65,35.86,10.08,134.52,183.13,41.45,102.39,2.81,67.3,42.08,16.75,21.45,52.18]
				});


				option = {
				    baseOption: {
				        timeline: {
				            // y: 0,
				            axisType: 'category',
				            // realtime: false,
				            // loop: false,
				            autoPlay: true,
				            // currentIndex: 2,
				            playInterval: 1000,
				            // controlStyle: {
				            //     position: 'left'
				            // },
				            data: [
				                'java','python','c#','web','linux'
				            ],
				            label: {
				                formatter : function(s) {
				                    return s;
				                }
				            }
				        },
				        title: {
				            subtext: '数据来自edmund'
				        },
				        tooltip: {
				        },
				        legend: {
				            x: 'right',
				            data: ['人才需求', '平均工资', '最低平均工资', '最高平均工资', '金融', '房地产'],
				            selected: {
				                'GDP': false, '金融': false, '房地产': false
				            }
				        },
				        calculable : true,
				        grid: {
				            top: 80,
				            bottom: 100,
				            tooltip: {
				                trigger: 'axis',
				                axisPointer: {
				                    type: 'shadow',
				                    label: {
				                        show: true,
				                        formatter: function (params) {
				                            return params.value.replace('\n', '');
				                        }
				                    }
				                }
				            }
				        },
				        xAxis: [
				            {
				                'type':'category',
				                'axisLabel':{'interval':0},
				                'data':[
				                    '北京','\n天津','河北','\n山西','内蒙古','\n辽宁','吉林','\n黑龙江',
				                    '上海','\n江苏','浙江','\n安徽','福建','\n江西','山东','\n河南',
				                    '湖北','\n湖南','广东','\n广西','海南','\n重庆','四川','\n贵州',
				                    '云南','\n西藏','陕西','\n甘肃','青海','\n宁夏','新疆'
				                ],
				                splitLine: {show: false}
				            }
				        ],
				        yAxis: [
				            {
				                type: 'value',
				                name: 'salary（元/月）'
				            }
				        ],
				        series: [
				            {name: '人才需求', type: 'bar'},
				            {name: '平均工资', type: 'bar'},
				            {name: '最低平均工资', type: 'bar'},
				            {name: '最高平均工资', type: 'bar'},
				            {name: '金融', type: 'bar'},
				            {name: '房地产', type: 'bar'},
				        ]
				    },
				    options: [
				        {
				            title: {text: '全国java职业技能需求'},
				            series: [
				                {data: dataMap.dataGDP['1']},
				                {data: dataMap.dataFinancial['1']},
				                {data: dataMap.dataEstate['1']},
				                {data: dataMap.dataPI['1']},
				                {data: dataMap.dataSI['1']},
				                {data: dataMap.dataTI['1']}
				            ]
				        },
				        {
				            title : {text: '全国python职业技能需求'},
				            series : [
				                {data: dataMap.dataGDP['2']},
				                {data: dataMap.dataFinancial['2']},
				                {data: dataMap.dataEstate['2']},
				                {data: dataMap.dataPI['2']},
				                {data: dataMap.dataSI['2']},
				                {data: dataMap.dataTI['2']}
				            ]
				        },
				        {
				            title : {text: '全国c#职业技能需求'},
				            series : [
				                {data: dataMap.dataGDP['3']},
				                {data: dataMap.dataFinancial['3']},
				                {data: dataMap.dataEstate['3']},
				                {data: dataMap.dataPI['3']},
				                {data: dataMap.dataSI['3']},
				                {data: dataMap.dataTI['3']}
				            ]
				        },
				        {
				            title : {text: '全国web职业技能需求'},
				            series : [
				                {data: dataMap.dataGDP['4']},
				                {data: dataMap.dataFinancial['4']},
				                {data: dataMap.dataEstate['4']},
				                {data: dataMap.dataPI['4']},
				                {data: dataMap.dataSI['4']},
				                {data: dataMap.dataTI['4']}
				            ]
				        },
				        {
				            title : {text: '全国linux职业技能需求'},
				            series : [
				                {data: dataMap.dataGDP['5']},
				                {data: dataMap.dataFinancial['5']},
				                {data: dataMap.dataEstate['5']},
				                {data: dataMap.dataPI['5']},
				                {data: dataMap.dataSI['5']},
				                {data: dataMap.dataTI['5']}
				            ]
				        }
				    ]
				};
				// 使用刚指定的配置项和数据显示图表。
				myChart.setOption(option);
			}
		}
	}

	
</script>
</head>
<body onload="initData();" >
	<div id="main" style="width:1400px;height:1000px;border:1px solid" ></div>
</body>
</html>


